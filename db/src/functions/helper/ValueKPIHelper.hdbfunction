FUNCTION "ValueKPIHelper"(
    salesGroup NVARCHAR(6500), 
    startDate NVARCHAR(10),
    endDate NVARCHAR(10),
    customerCode NVARCHAR(500000),
    customerName NVARCHAR(255)
)
    RETURNS result DECIMAL(17, 1)
    LANGUAGE SQLSCRIPT
    SQL SECURITY INVOKER AS
BEGIN
    IF customerCode IS NULL THEN
        -- SELECT TO_DECIMAL(SUM("/BIC/CI_NETVAL") / 100000, 1, 1) INTO result
        -- FROM "/BIC/FCC_NSALE" FCC_NSALE
        -- JOIN "/BI0/SSALES_GRP" SSALES_GRP ON FCC_NSALE."SID_0SALES_GRP" = SSALES_GRP.SID AND SSALES_GRP.SALES_GRP IN (
        --     SELECT "RESULT" FROM "SplitCommaString"(:salesGroup)
        -- ) 
        -- JOIN "/BI0/SCUSTOMER" SCUSTOMER ON SCUSTOMER."SID" = FCC_NSALE."SID_0CUSTOMER"
        -- JOIN "/BI0/PCUSTOMER" PCUSTOMER ON PCUSTOMER."CUSTOMER" = SCUSTOMER."CUSTOMER" 
        -- AND PCUSTOMER."ACCNT_GRP" IN ('G001', 'G007', 'G008') 
        -- JOIN "/BI0/SPLANT" SPLANT ON FCC_NSALE."SID_0PLANT" = SPLANT."SID"
        -- JOIN "/BI0/PPLANT" PPLANT ON SPLANT."PLANT" = PPLANT."PLANT" AND PPLANT."/BIC/CI_GEODIV" != 'EX'
        -- WHERE TO_DATE("SID_0CALDAY") BETWEEN startDate AND endDate
        -- AND FCC_NSALE."SID_CI_DIPIND" IN (3, 15) AND FCC_NSALE."SID_0MATL_TYPE" IN (5, 15, 91, 92, 101) AND SID_0COMP_CODE IN (2) AND FCC_NSALE."SID_0FISCVARNT" IN (9); 

        SELECT TO_DECIMAL(SUM("/BIC/CI_NETVAL") / 100000, 1, 1) INTO result
        FROM "/BIC/FCC_NSALE" FCC_NSALE
        JOIN "/BI0/SSALES_GRP" SSALES_GRP ON FCC_NSALE."SID_0SALES_GRP" = SSALES_GRP.SID 
        -- AND SSALES_GRP.SALES_GRP IN (
        --     SELECT "RESULT" FROM "SplitCommaString"(:salesGroup)
        -- ) 
        JOIN "/BI0/SCUSTOMER" SCUSTOMER ON SCUSTOMER."SID" = FCC_NSALE."SID_0CUSTOMER"
        JOIN "/BI0/PCUSTOMER" PCUSTOMER ON PCUSTOMER."CUSTOMER" = SCUSTOMER."CUSTOMER" 
        AND PCUSTOMER."ACCNT_GRP" IN ('G001', 'G007', 'G008') AND PCUSTOMER."SALES_GRP" IN (
            SELECT "RESULT" FROM "SplitCommaString"(:salesGroup)
        )
        JOIN "/BI0/SPLANT" SPLANT ON FCC_NSALE."SID_0PLANT" = SPLANT."SID"
        JOIN "/BI0/PPLANT" PPLANT ON SPLANT."PLANT" = PPLANT."PLANT" AND PPLANT."/BIC/CI_GEODIV" != 'EX'
        WHERE TO_DATE("SID_0CALDAY") BETWEEN startDate AND endDate
        AND FCC_NSALE."SID_CI_DIPIND" IN (3, 15) AND FCC_NSALE."SID_0MATL_TYPE" IN (5, 15, 91, 92, 101) AND SID_0COMP_CODE IN (2) AND FCC_NSALE."SID_0FISCVARNT" IN (9);

    ELSE
        -- SELECT TO_DECIMAL(SUM("/BIC/CI_NETVAL") / 100000, 1, 1) INTO result
        -- FROM "/BIC/FCC_NSALE" FCC_NSALE
        -- JOIN "/BI0/SSALES_GRP" SSALES_GRP ON FCC_NSALE."SID_0SALES_GRP" = SSALES_GRP.SID AND SSALES_GRP.SALES_GRP IN (
        --     SELECT "RESULT" FROM "SplitCommaString"(:salesGroup)
        -- ) 
        -- JOIN "/BI0/SCUSTOMER" SCUSTOMER ON SCUSTOMER."SID" = FCC_NSALE."SID_0CUSTOMER" 
        -- AND SCUSTOMER."CUSTOMER" IN (
        --     SELECT "RESULT" FROM "SplitCommaString"(:customerCode)
        -- )
        -- JOIN "/BI0/PCUSTOMER" PCUSTOMER ON PCUSTOMER."CUSTOMER" = SCUSTOMER."CUSTOMER" 
        -- AND PCUSTOMER."ACCNT_GRP" IN ('G001', 'G007', 'G008')
        -- JOIN "/BI0/SPLANT" SPLANT ON FCC_NSALE."SID_0PLANT" = SPLANT."SID"
        -- JOIN "/BI0/PPLANT" PPLANT ON SPLANT."PLANT" = PPLANT."PLANT" AND PPLANT."/BIC/CI_GEODIV" != 'EX'
        -- WHERE TO_DATE("SID_0CALDAY") BETWEEN startDate AND endDate
        -- AND FCC_NSALE."SID_CI_DIPIND" IN (3, 15) AND FCC_NSALE."SID_0MATL_TYPE" IN (5, 15, 91, 92, 101) AND SID_0COMP_CODE IN (2) AND FCC_NSALE."SID_0FISCVARNT" IN (9);
    
        SELECT TO_DECIMAL(SUM("/BIC/CI_NETVAL") / 100000, 1, 1) INTO result
        FROM "/BIC/FCC_NSALE" FCC_NSALE
        JOIN "/BI0/SSALES_GRP" SSALES_GRP ON FCC_NSALE."SID_0SALES_GRP" = SSALES_GRP.SID 
        -- AND SSALES_GRP.SALES_GRP IN (
        --     SELECT "RESULT" FROM "SplitCommaString"(:salesGroup)
        -- ) 
        JOIN "/BI0/SCUSTOMER" SCUSTOMER ON SCUSTOMER."SID" = FCC_NSALE."SID_0CUSTOMER" 
        AND SCUSTOMER."CUSTOMER" IN (
            SELECT "RESULT" FROM "SplitCommaString"(:customerCode)
        )
        JOIN "/BI0/PCUSTOMER" PCUSTOMER ON PCUSTOMER."CUSTOMER" = SCUSTOMER."CUSTOMER" 
        AND PCUSTOMER."ACCNT_GRP" IN ('G001', 'G007', 'G008') AND PCUSTOMER."SALES_GRP" IN (
            SELECT "RESULT" FROM "SplitCommaString"(:salesGroup)
        )
        JOIN "/BI0/SPLANT" SPLANT ON FCC_NSALE."SID_0PLANT" = SPLANT."SID"
        JOIN "/BI0/PPLANT" PPLANT ON SPLANT."PLANT" = PPLANT."PLANT" AND PPLANT."/BIC/CI_GEODIV" != 'EX'
        WHERE TO_DATE("SID_0CALDAY") BETWEEN startDate AND endDate
        AND FCC_NSALE."SID_CI_DIPIND" IN (3, 15) AND FCC_NSALE."SID_0MATL_TYPE" IN (5, 15, 91, 92, 101) AND SID_0COMP_CODE IN (2) AND FCC_NSALE."SID_0FISCVARNT" IN (9);

    END IF;
END;